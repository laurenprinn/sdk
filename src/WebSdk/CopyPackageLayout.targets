<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

<Target Name="PrepareAdditionalFilesToLayout" BeforeTargets="AssignTargetPaths">
  <ItemGroup>
    <LayoutFile Include="@(Content)" Condition="'%(Content.PackagePath)' != '' and '%(Content.PackagePath)' != 'Icon.png'">
      <TargetPath>%(Content.PackagePath)\%(Content.RecursiveDir)%(Content.Filename)%(Content.Extension)</TargetPath>
    </LayoutFile>
  </ItemGroup>
</Target>

<Target Name="CopyAdditionalFilesToLayout" Condition="'$(TargetFramework)' == ''" DependsOnTargets="PrepareAdditionalFilesToLayout" AfterTargets="Build" Inputs="@(LayoutFile)" Outputs="@(LayoutFile->'$(PackageLayoutOutputPath)%(TargetPath)')">
  <Copy SourceFiles="@(LayoutFile)" DestinationFiles="@(LayoutFile->'$(PackageLayoutOutputPath)%(TargetPath)')">
    <Output TaskParameter="DestinationFiles" ItemName="FileWrites" />
  </Copy>
</Target>

<Target Name="PackLayout" DependsOnTargets="CopyAdditionalFilesToLayout" BeforeTargets="$(GenerateNuspecDependsOn)">
  <ItemGroup>
    <Content Include="$(PackageLayoutOutputPath)**\*" PackagePath="\" />
  </ItemGroup>
</Target>

</Project>
